    /**
     * Make sure that deleting a folder deletes all child folders.
     */
    public void testFolderCascadingDelete() throws Exception {
        
        log.info("BEGIN");
        
        BookmarkManager bmgr = WebloggerFactory.getWeblogger().getBookmarkManager();
        
        testWeblog = TestUtils.getManagedWebsite(testWeblog);
        WeblogBookmarkFolder root = bmgr.getRootFolder(testWeblog);
        
        // add a small tree /fold1/fold2
        WeblogBookmarkFolder fold1 = new WeblogBookmarkFolder(root, "fold1", null, testWeblog);
        root.addFolder(fold1);
        bmgr.saveFolder(fold1);
        WeblogBookmarkFolder fold2 = new WeblogBookmarkFolder(fold1, "fold2", null, testWeblog);
        fold1.addFolder(fold2);
        bmgr.saveFolder(fold2);
        TestUtils.endSession(true);
        
        // check that tree can be navigated
        testWeblog = TestUtils.getManagedWebsite(testWeblog);
        root = bmgr.getRootFolder(testWeblog);
        assertEquals(1, root.getFolders().size());
        fold1 = (WeblogBookmarkFolder) root.getFolders().iterator().next();
        assertEquals("fold1", fold1.getName());
        assertEquals(1, fold1.getFolders().size());
        fold2 = (WeblogBookmarkFolder) fold1.getFolders().iterator().next();
        assertEquals("fold2", fold2.getName());
        
        // now delete folder and subfolders should be deleted by cascade
        bmgr.removeFolder(fold1);
        TestUtils.endSession(true);
        
        // verify cascading delete succeeded
        testWeblog = TestUtils.getManagedWebsite(testWeblog);
        root = bmgr.getRootFolder(testWeblog);
        assertEquals(0, root.getFolders().size());
        assertNull(bmgr.getFolder(testWeblog, "/fold1/fold2"));
        
        log.info("END");
    }

