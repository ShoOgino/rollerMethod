    /**     * Test to see if Referer Spam detection works.     */    /* Referrer spam detection now happens in the RefererFilter -- Allen G    public void testSpamBlocking()    {        boolean isSpam = rmgr.processRequest(            new MockRequest(                "20040101",                "http://www.spamtest.com",                "http://test.com",                null, mWebsite            )        );        //assertTrue("failed to detect referer spam", isSpam);    }    */        public void testApplyRefererFilters() throws Exception    {        List refs = rmgr.getReferers(mWebsite);        assertEquals(count, refs.size());        String origWords = null;                getRoller().begin(UserData.SYSTEM_USER);        Roller mRoller = getRoller();        PropertiesManager pmgr = mRoller.getPropertiesManager();        RollerPropertyData spamprop = pmgr.getProperty("spam.blacklist");        origWords = spamprop.getValue();        spamprop.setValue(spamprop.getValue() + ", test");        pmgr.store(spamprop);        getRoller().commit();                getRoller().begin(UserData.SYSTEM_USER);        getRoller().getRefererManager().applyRefererFilters();        getRoller().commit();                refs = rmgr.getReferers(mWebsite);        assertEquals(0, refs.size());        getRoller().begin(UserData.SYSTEM_USER);        spamprop = pmgr.getProperty("spam.blacklist");        spamprop.setValue(origWords);        pmgr.store(spamprop);        getRoller().commit();    }
