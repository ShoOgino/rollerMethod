    public void testAddRemoveUser() throws RollerException
    {
        UserManager umgr = getRoller().getUserManager();

        // Add a user

        getRoller().begin(UserData.SYSTEM_USER);
        UserData user = new UserData(
            null,
            "testAddRemoveUser",
            "password4",
            "TestUser4",
            "testuser4@example.com",
            "en_US_WIN", "America/Los_Angeles",
            new java.util.Date(), Boolean.TRUE);
        Map pages = new HashMap();
        pages.put("Weblog","Weblog page content");
        pages.put("_day","Day page content");
        pages.put("css","CSS page content");
        umgr.addUser(user);
        umgr.createWebsite(user, pages, 
                user.getUserName(), user.getUserName(), user.getUserName(), 
                "basic", "en_US_WIN", "America/Los_Angeles");
        getRoller().commit();

        // Verify that user has all the goodies
        getRoller().begin(UserData.SYSTEM_USER);
        UserData user1 = umgr.retrieveUser(user.getId());
        assertNotNull(user1);

        WebsiteData website = (WebsiteData)umgr.getWebsites(user, null).get(0);
        assertNotNull(website);

        FolderData root = getRoller().getBookmarkManager().getRootFolder(website);
        assertNotNull(root);

        List pages1 = getRoller().getUserManager().getPages(website);
        assertEquals(3, pages1.size());
        getRoller().rollback();

        // Remove the website and user
        getRoller().begin(UserData.SYSTEM_USER);
        website = umgr.retrieveWebsite(website.getId());
        website.remove();
        user = umgr.retrieveUser(user.getId());
        user.remove();
        getRoller().commit();

        // Verify that user was completely deleted
        getRoller().begin(UserData.SYSTEM_USER);
        UserData user2 = umgr.retrieveUser(user.getId());
        assertNull(user2);

        assertNull(getRoller().getBookmarkManager().retrieveFolder(root.getId()));

        List pages2 = getRoller().getUserManager().getPages(website);
        assertEquals(0, pages2.size());
        getRoller().rollback();
    }

