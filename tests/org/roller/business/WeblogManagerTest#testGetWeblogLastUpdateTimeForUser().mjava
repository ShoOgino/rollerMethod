//    //-----------------------------------------------------------------------
//    
//    /** Add a small category tree to the small test website (mWebsite). */
//    public void testGetRecent() throws Exception
//    {
//        //getRoller().begin();
//        
//        WebsiteData wd = null;
//        WeblogCategoryData root = null;
//        WeblogManager wmgr = getRoller().getWeblogManager();
//
//        wd = getRoller().getUserManager().retrieveWebsite(mWebsite.getId());
//        root = wmgr.getRootWeblogCategory(wd);
//
//        // create top level folders
//        WeblogCategoryData t1 = wmgr.createWeblogCategory();
//        t1.setName("toplevel1");
//        t1.setParent(root);
//        t1.setWebsite(wd);
//        t1.save();       
//        
//        WeblogCategoryData t2 = wmgr.createWeblogCategory();
//        t2.setName("toplevel2");
//        t2.setParent(root);
//        t2.setWebsite(wd);
//        t2.save();       
//        
//        WeblogCategoryData t3 = wmgr.createWeblogCategory();
//        t3.setName("toplevel3");
//        t3.setParent(root);
//        t3.setWebsite(wd);
//        t3.save(); 
//        
//        getRoller().commit(); 
//        
//        //getRoller().begin(); 
//        
//        // get persistent instances
//        t1 = wmgr.retrieveWeblogCategory(t1.getId());
//        wd = getRoller().getUserManager().retrieveWebsite(mWebsite.getId());
//        
//        // Create four entries in 1st category
//        WeblogEntryData e1 = new WeblogEntryData(
//                null, t1, wd, "title1", null, "text1", "anchor", 
//                new Timestamp(0), new Timestamp(0), Boolean.FALSE);
//        e1.save();
//        
//        WeblogEntryData e2 = new WeblogEntryData(
//                null, t1, wd, "title2", null, "text2", "anchor", 
//                new Timestamp(0), new Timestamp(0), Boolean.FALSE);
//        e2.save();
//        
//        WeblogEntryData e3 = new WeblogEntryData(
//                null, t1, wd, "title3", null, "text3", "anchor", 
//                new Timestamp(0), new Timestamp(0), Boolean.FALSE);
//        e3.save();
//        
//        WeblogEntryData e4 = new WeblogEntryData(
//                null, t1, wd, "title4", null, "text4", "anchor", 
//                new Timestamp(0), new Timestamp(0), Boolean.FALSE);
//        e4.save();
//        
//        getRoller().commit(); 
//        
//        //getRoller().begin();
//        
//        //List entries = wmgr.getRecentWeblogEntriesArray(
//            //wd.getUser().getUserName(), new Date(), "toplevel1", 15, false);
//        
//        List entries = wmgr.getWeblogEntries(
//                        wd,
//                        null,                       // startDate
//                        new Date(),                 // endDate
//                        "toplevel1",                 // catName
//                        WeblogManager.ALL,           // status
//                        new Integer(15));           // maxEntries
//
//        assertEquals(4, entries.size());
//        
//        getRoller().rollback();
//    }
//    
//    public void testGetWeblogCategoryRoot() throws Exception
//    {
//        //getRoller().begin();
//        WeblogManager wmgr = getRoller().getWeblogManager();
//        assertNotNull(wmgr.getRootWeblogCategory(mWebsite));
//        getRoller().rollback();
//    }    
//    
//    public void testGetWeblogCategories() throws Exception
//    {
//        //getRoller().begin();
//        WeblogManager wmgr = getRoller().getWeblogManager();
//        assertEquals(8, wmgr.getWeblogCategories(mWebsite).size());
//        getRoller().rollback();
//    }    
//    
//    public void testWeblogCategoryPaths() throws Exception
//    {
//        WebsiteData wd = null;
//        WeblogCategoryData root = null;
//        WeblogManager wmgr = getRoller().getWeblogManager();
//        
//        //getRoller().begin();
//        
//        wd = getRoller().getUserManager().retrieveWebsite(mWebsite.getId());
//        root = wmgr.getRootWeblogCategory(wd);
//
//        WeblogCategoryData f1 = wmgr.createWeblogCategory();
//        f1.setName("f1");
//        f1.setParent(root);
//        f1.setWebsite(wd);
//        f1.save();
//        
//        WeblogCategoryData f2 = wmgr.createWeblogCategory(); 
//        f2.setName("f2");
//        f2.setParent(f1);
//        f2.setWebsite(wd);
//        f2.save();
//      
//        WeblogCategoryData f3 = wmgr.createWeblogCategory(); 
//        f3.setName("f3");
//        f3.setParent(f2);
//        f3.setWebsite(wd);
//        f3.save();
//        
//        getRoller().commit();
//        
//        //getRoller().begin();
//        
//        // check count of descendents and ancestors
//        f1 = wmgr.retrieveWeblogCategory(f1.getId());        
//        assertEquals(2, f1.getAllDescendentAssocs().size());
//        assertEquals(1, f1.getAncestorAssocs().size());
//        
//        f2 = wmgr.retrieveWeblogCategory(f2.getId());        
//        assertEquals(1, f2.getAllDescendentAssocs().size());
//        assertEquals(2, f2.getAncestorAssocs().size());
//        
//        f3 = wmgr.retrieveWeblogCategory(f3.getId());        
//        assertEquals(0, f3.getAllDescendentAssocs().size());
//        assertEquals(3, f3.getAncestorAssocs().size());
//        
//        // test get by path
//        assertEquals("f1", 
//            wmgr.getWeblogCategoryByPath(wd, null, "f1").getName());
//        
//        assertEquals("f1", 
//            wmgr.getWeblogCategoryByPath(wd, null, "/f1").getName());
//        
//        assertEquals("f2", 
//            wmgr.getWeblogCategoryByPath(wd, null, "/f1/f2").getName());
//        
//        assertEquals("f3", 
//            wmgr.getWeblogCategoryByPath(wd, null, "/f1/f2/f3").getName());
//        
//        // test path creation
//        f3 = wmgr.getWeblogCategoryByPath(wd, null, "/f1/f2/f3");
//        String pathString = wmgr.getPath(f3);
//        String[] pathArray = Utilities.stringToStringArray(pathString,"/");
//        assertEquals("f1", pathArray[0]);
//        assertEquals("f2", pathArray[1]);
//        assertEquals("f3", pathArray[2]);
//        
//        getRoller().commit();
//    }    
//        
//    //-----------------------------------------------------------------------
//    
//    public void testGetWeblogEntryByAnchor() throws Exception
//    {
//        WeblogManager wmgr = getRoller().getWeblogManager();
//        
//        WeblogEntryData entry1 = (WeblogEntryData)mEntriesCreated.get(0);
//        
//        WebsiteData website = entry1.getWebsite();
//        
//        WeblogEntryData entry2 = wmgr.getWeblogEntryByAnchor(
//            website, entry1.getAnchor() );
//        
//        assertEquals( entry1.getId(), entry2.getId() );
//    }
//     
    //-----------------------------------------------------------------------
    /**
     * Test latest publishTime for a User.
     * This test passes inconsistently - I suspect Hibernate.
     */
    public void testGetWeblogLastUpdateTimeForUser() throws Exception
    {
        WeblogManager wmgr = getRoller().getWeblogManager();

        /** 
         * really weird, but we cannot get 'entry1' directly,
         * we have to iterate over entries.  We end up getting the same one
         * either way, but fetching it directly fails!
         */
        int lastEntryIndex = (mEntriesCreated.size()-1);
        //System.out.println("# entries:" + lastEntryIndex);
        WeblogEntryData entry1 = null;
        //WeblogEntryData entry1 = (WeblogEntryData)mEntriesCreated.get(lastEntryIndex);
        if (entry1 == null || !entry1.getPublishEntry().booleanValue()) // if not published, find one
        {
            for (int i=lastEntryIndex; i >= 0; i--)
            {
                entry1 = (WeblogEntryData)        
                    mEntriesCreated.get(i); // last entry is newest
                //System.out.println("entry " + i + "published:" + entry1.getPublishEntry());
                if (entry1.getPublishEntry().booleanValue()) {
                    break;
                }
            }
        }
        
        WebsiteData website = entry1.getWebsite();
        UserData user = website.getUser();        
        Date updateTime = wmgr.getWeblogLastPublishTime(user.getUserName());
                
        assertEquals("THIS FAILS RANDOMLY, TRY AGAIN", entry1.getPubTime(),updateTime);
    }

