    protected void authenticateUser(String username, String role) 
        throws RollerException
    {
        MockHttpServletRequest mockRequest = getMockFactory().getMockRequest();
        mockRequest.setRemoteUser(username);
        mockRequest.setUserPrincipal(new MockPrincipal(username));
        mockRequest.setUserInRole(role, true);
        
        HttpSession session = mockRequest.getSession(true);        
        RollerSession rollerSession = new RollerSession();
        UserManager umgr = getRoller().getUserManager();
        UserData user = umgr.getUser(username);
        WebsiteData website = (WebsiteData)umgr.getWebsites(user, null).get(0); 
        rollerSession.setCurrentWebsite(website);
        session.setAttribute(RollerSession.ROLLER_SESSION, rollerSession);
    }

