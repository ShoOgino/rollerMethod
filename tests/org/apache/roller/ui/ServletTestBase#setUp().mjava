    public void setUp() throws Exception {
        getMockFactory().refresh();
        
        servletModule = new ServletTestModule(getMockFactory());
        strutsModule = new ActionTestModule(getStrutsMockFactory());
        
        MockHttpServletRequest request = getMockFactory().getMockRequest();
        request.setContextPath("/roller");

        RollerRuntimeConfig.setAbsoluteContextURL("http://localhost:8080/roller");
        
        JspFactory.setDefaultFactory(new MockJspFactory(getMockFactory()));
                
        MockServletContext ctx = getMockFactory().getMockServletContext();
        ctx.setServletContextName("/roller"); 
        ctx.setRealPath("/", ".");    
        
        
        ctx.setInitParameter("contextConfigLocation", "WEB-INF/security.xml");
        ctx.setResourceAsStream("/WEB-INF/security.xml", 
            new FileInputStream("WEB-INF" + File.separator + "security.xml")); 
        
        ctx.setResourceAsStream("/WEB-INF/velocity.properties", 
            new FileInputStream("WEB-INF" + File.separator + "velocity.properties")); 
        
        rollerContext = new MockRollerContext();
        rollerContext.init(ctx);
    }

