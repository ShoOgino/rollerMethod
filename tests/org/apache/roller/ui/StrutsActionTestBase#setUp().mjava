    public void setUp() throws Exception {
        getMockFactory().refresh();
        
        strutsModule = new ActionTestModule(getStrutsMockFactory());
        servletModule = new ServletTestModule(getStrutsMockFactory());
        
        // Setup mocks needed to run a Struts action
                
        MapMessageResources resources = new MapMessageResources();
        resources.putMessages("WEB-INF/classes/ApplicationResources.properties");
        strutsModule.setResources(resources);
        
        RollerRuntimeConfig.setAbsoluteContextURL("http://localhost:8080/roller");

        MockServletContext ctx = getMockFactory().getMockServletContext();
        ctx.setServletContextName("/roller"); 
        ctx.setRealPath("/", ".");
        
        ctx.setInitParameter("contextConfigLocation", "WEB-INF/security.xml");
        ctx.setResourceAsStream("/WEB-INF/security.xml", 
            new FileInputStream("WEB-INF" + File.separator + "security.xml")); 
        
        ctx.setResourceAsStream("/WEB-INF/velocity.properties", 
            new FileInputStream("WEB-INF" + File.separator + "velocity.properties")); 
        
        rollerContext = new MockRollerContext();
        rollerContext.init(ctx);
    }

