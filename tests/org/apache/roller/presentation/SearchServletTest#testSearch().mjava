    public void testSearch() throws Exception
    {
        servletModule.setServlet(
            servletModule.createServlet(SearchServlet.class)); 
        MockHttpServletRequest mockRequest = getMockFactory().getMockRequest();

        mockRequest.setContextPath("/search");
        mockRequest.setupAddParameter("q","test");
 
        servletModule.createFilter(PersistenceSessionFilter.class);
        servletModule.createFilter(RequestFilter.class);
        servletModule.setDoChain(true);
        
        servletModule.doFilter();        
        getMockFactory().addRequestWrapper(new HttpServletRequestWrapper(
            (HttpServletRequest)servletModule.getFilteredRequest()));
        servletModule.doGet();
        assertNotNull(
            servletModule.getRequestAttribute("zzz_VelocityContext_zzz"));     
    }

