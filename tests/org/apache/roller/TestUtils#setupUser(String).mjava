    /**
     * Convenience method that creates a user and stores it.
     */
    public static User setupUser(String username) throws Exception {
        
        User testUser = new User();
        testUser.setUserName(username);
        testUser.setPassword("password");
        testUser.setScreenName("Test User Screen Name");
        testUser.setFullName("Test User");
        testUser.setEmailAddress("TestUser@dev.null");
        testUser.setLocale("en_US");
        testUser.setTimeZone("America/Los_Angeles");
        testUser.setDateCreated(new java.util.Date());
        testUser.setEnabled(Boolean.TRUE);
        
        // store the user
        UserManager mgr = RollerFactory.getRoller().getUserManager();
        mgr.addUser(testUser);
        
        // flush to db
        RollerFactory.getRoller().flush();
        
        // query for the user to make sure we return the persisted object
        User user = mgr.getUserByUserName(username);
        
        if(user == null)
            throw new RollerException("error inserting new user");
        
        return user;
    }

