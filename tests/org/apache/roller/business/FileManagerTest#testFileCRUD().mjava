    public void testFileCRUD() throws Exception {
        
        // update roller properties to prepare for test
        PropertiesManager pmgr = RollerFactory.getRoller().getPropertiesManager();
        Map config = pmgr.getProperties();
        ((RollerPropertyData)config.get("uploads.enabled")).setValue("true");
        ((RollerPropertyData)config.get("uploads.types.allowed")).setValue("opml");
        ((RollerPropertyData)config.get("uploads.dir.maxsize")).setValue("1.00");
        pmgr.saveProperties(config);
        TestUtils.endSession(true);
        
        /* NOTE: upload dir for unit tests is set in
               roller/personal/testing/roller-custom.properties */
        FileManager fmgr = RollerFactory.getRoller().getFileManager();
        
        // we should be starting with 0 files
        assertEquals(0, fmgr.getFiles(testWeblog.getHandle(), null).length);
        
        // create a directory
        fmgr.createDirectory(testWeblog.getHandle(), "subdir");
        
        // make sure directory was created
        assertEquals(1, fmgr.getFiles(testWeblog.getHandle(), null).length);
        
        // store a file
        InputStream is = getClass().getResourceAsStream("/bookmarks.opml");
        fmgr.saveFile(testWeblog.getHandle(), "bookmarks.opml", "text/plain", 1545, is);
        
        // make sure file was stored successfully
        assertEquals(2, fmgr.getFiles(testWeblog.getHandle(), null).length);
        
        // store a file into a subdirectory
        is = getClass().getResourceAsStream("/bookmarks.opml");
        fmgr.saveFile(testWeblog.getHandle(), "subdir/bookmarks.opml", "text/plain", 1545, is);
        
        // make sure file was stored successfully
        assertEquals(1, fmgr.getFiles(testWeblog.getHandle(), "subdir").length);
        
        // delete files and dirs
        fmgr.deleteFile(testWeblog.getHandle(), "bookmarks.opml");
        fmgr.deleteFile(testWeblog.getHandle(), "subdir/bookmarks.opml");
        fmgr.deleteFile(testWeblog.getHandle(), "subdir");
        
        // make sure delete was successful
        Thread.sleep(2000);
        assertEquals(0, fmgr.getFiles(testWeblog.getHandle(), null).length);
    }

