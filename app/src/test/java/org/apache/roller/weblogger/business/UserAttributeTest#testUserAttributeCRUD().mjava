    /**
     * Test basic persistence operations ... Create, Update, Delete.
     */
    public void testUserAttributeCRUD() throws Exception {
        log.debug("BEGIN");
        User user = TestUtils.setupUser("auser");

        UserManager umgr = WebloggerFactory.getWeblogger().getUserManager();
        umgr.setUserAttribute(user.getUserName(), "testattname", "testattvalue");
        TestUtils.endSession(true);
        
        assertEquals(user.getId(), umgr.getUserByAttribute("testattname", "testattvalue").getId());
        
        user = TestUtils.getManagedUser(user);
        user.setEnabled(Boolean.FALSE);
        umgr.saveUser(user);
        TestUtils.endSession(true);
        
        assertNull(umgr.getUserByAttribute("testattname", "testattvalue"));
        
        TestUtils.teardownUser(user.getUserName());

        assertEquals(0, umgr.getUserAttributes("auser").size());
        
        log.debug("END");
    }

