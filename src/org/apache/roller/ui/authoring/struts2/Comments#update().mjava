    /**
     * Update a list of comments.
     */
    public String update() {
        
        try {
            WeblogManager wmgr = RollerFactory.getRoller().getWeblogManager();
            
            List<CommentData> flushList = new ArrayList();
            
            // delete all comments with delete box checked
            List<String> deletes = Arrays.asList(getBean().getDeleteComments());
            if(deletes != null && deletes.size() > 0) {
                log.debug("Processing deletes - "+deletes.size());
                
                CommentData deleteComment = null;
                for(String deleteId : deletes) {
                    deleteComment = wmgr.getComment(deleteId);
                    
                    // make sure comment is tied to action weblog
                    if(getActionWeblog().equals(deleteComment.getWeblogEntry().getWebsite())) {
                        wmgr.removeComment(deleteComment);
                        flushList.add(deleteComment);
                    }
                }
            }
            
            // loop through IDs of all comments displayed on page
            List<String> approvedIds = Arrays.asList(getBean().getApprovedComments());
            List<String> spamIds = Arrays.asList(getBean().getSpamComments());
            log.debug(spamIds.size()+" comments marked as spam");
            
            // track comments approved via moderation
            List<CommentData> approvedComments = new ArrayList();
            
            String[] ids = Utilities.stringToStringArray(getBean().getIds(),",");
            for (int i=0; i < ids.length; i++) {
                log.debug("processing id - "+ ids[i]);
                
                // if we already deleted it then skip forward
                if(deletes.contains(ids[i])) {
                    log.debug("Already deleted, skipping - "+ids[i]);
                    continue;
                }
                
                CommentData comment = wmgr.getComment(ids[i]);
                
                // make sure comment is tied to action weblog
                if(getActionWeblog().equals(comment.getWeblogEntry().getWebsite())) {
                    // comment approvals and mark/unmark spam
                    if(approvedIds.contains(ids[i])) {
                        // if a comment was previously PENDING then this is
                        // it's first approval, so track it for notification
                        if(CommentData.PENDING.equals(comment.getStatus())) {
                            approvedComments.add(comment);
                        }
                        
                        log.debug("Marking as approved - "+comment.getId());
                        comment.setStatus(CommentData.APPROVED);
                        wmgr.saveComment(comment);
                        
                        flushList.add(comment);
                        
                    } else if(spamIds.contains(ids[i])) {
                        log.debug("Marking as spam - "+comment.getId());
                        comment.setStatus(CommentData.SPAM);
                        wmgr.saveComment(comment);
                        
                        flushList.add(comment);
                    } else if(!CommentData.DISAPPROVED.equals(comment.getStatus())) {
                        log.debug("Marking as disapproved - "+comment.getId());
                        comment.setStatus(CommentData.DISAPPROVED);
                        wmgr.saveComment(comment);
                        
                        flushList.add(comment);
                    }
                }
            }
            
            RollerFactory.getRoller().flush();
            
            // notify caches of changes
            for(CommentData comm : flushList) {
                CacheManager.invalidate(comm);
            }
            
//            sendCommentNotifications(request, approvedComments);
            
            addMessage("commentManagement.updateSuccess");
            
            // reset form and load fresh comments list
            setBean(new CommentsBean());
            
            return execute();
            
        } catch (Exception ex) {
            log.error("ERROR updating comments", ex);
            addError("commentManagement.updateError", ex.toString());
        }
        
        return LIST;
    }

