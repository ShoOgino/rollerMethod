    protected Document getDocument(WeblogEntryData data)    {        StringBuffer commentEmail = new StringBuffer();        StringBuffer commentContent = new StringBuffer();        StringBuffer commentName = new StringBuffer();        List comments = data.getComments();		if (comments != null)         {            for (Iterator cItr = comments.iterator(); cItr.hasNext();)            {                CommentData comment = (CommentData) cItr.next();                if (comment.getSpam() == null ||                     !comment.getSpam().booleanValue())                 {                    if (comment.getContent() != null)                    {                        commentContent.append(comment.getContent());                        commentContent.append(",");                    }                    if (comment.getEmail() != null)                    {                        commentEmail.append(comment.getEmail());                        commentEmail.append(",");                    }                    if (comment.getName() != null)                    {                        commentName.append(comment.getName());                        commentName.append(",");                    }                }            }        }		        Document doc = new Document();        doc.add(Field.UnIndexed(FieldConstants.ID, data.getId()));        doc.add(Field.UnIndexed(FieldConstants.ANCHOR, data.getAnchor()));        doc.add(Field.Text(FieldConstants.USERNAME,                           data.getWebsite().getUser().getUserName()));        doc.add(Field.Text(FieldConstants.TITLE, data.getTitle()));                // index the entry text, but don't store it - moved to end of block        doc.add(Field.UnStored(FieldConstants.CONTENT, data.getText()));                // store an abbreviated version of the entry text, but don't index        doc.add(Field.UnIndexed(FieldConstants.CONTENT_STORED,                                 Utilities.truncateNicely(                                    Utilities.removeHTML(data.getText()),                                    240, 260, "...")));                doc.add(Field.Keyword(FieldConstants.UPDATED, data.getUpdateTime().toString()));        doc.add(Field.Keyword(FieldConstants.PUBLISHED, data.getPubTime().toString()));                // index Comments        doc.add(Field.UnStored(FieldConstants.C_CONTENT,                               commentContent.toString()));        doc.add(Field.UnStored(FieldConstants.C_EMAIL, commentEmail.toString()));        doc.add(Field.UnStored(FieldConstants.C_NAME, commentName.toString()));                doc.add(Field.UnStored(FieldConstants.CONSTANT,                               FieldConstants.CONSTANT_V));                // index Category        WeblogCategoryData categorydata = data.getCategory();        Field category =            (categorydata == null)            ? Field.UnStored(FieldConstants.CATEGORY, "")            : Field.Text(FieldConstants.CATEGORY, categorydata.getName());        doc.add(category);                return doc;    }
